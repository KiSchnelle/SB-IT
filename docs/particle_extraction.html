<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Extracting Particles</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600;700&family=Spline+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="page">
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <div class="eyebrow">StrubiOS - EM Data Processing</div>
          <div class="brand-title">Guidelines</div>
        </div>
        <nav class="nav">
          <a href="index.html">Overview</a>
          <div class="nav-group">
            <div class="nav-label">Cluster</div>
            <a href="cluster_usage.html">Using the SB-HPC cluster</a>
            <a href="cluster_resources.html">Cluster resources</a>
          </div>
          <div class="nav-group">
            <div class="nav-label">Sessions</div>
            <a href="session_guidelines.html">Session and project guidelines</a>
            <a href="particle_extraction.html">Extracting Particles</a>
            <a href="data_cleanup.html">Data Cleanup</a>
            <a href="data_transfer.html">Data Transfer</a>
          </div>
          <div class="nav-group">
            <div class="nav-label">Software</div>
            <a href="software/slurm_usage.html">Slurm usage</a>
            <a href="software/phenix.html">Using Phenix</a>
            <a href="software/topaz.html">Using Topaz</a>
            <a href="software/eman2.html">Using Eman2</a>
            <a href="software/cryolo.html">Using cryolo</a>
          </div>
        </nav>
      </aside>

      <main class="content">
        <header class="page-header reveal" style="--delay: 0.05s;">
          <h1>Guidlines on particle extraction</h1>
          <p class="lead">Particles never need to be extraced at full box size at the start. Binning 2-4 times is more then enough to sort out bad particles.</p>
        </header>

        <section class="section reveal" style="--delay: 0.1s;">
          <h2>Choosing the right box size.</h2>
          <p>The box size should be around 1.3 to 2 times your particles size.</p>
          <div class="callout">
            <math xmlns="http://www.w3.org/1998/Math/MathML">
              <mrow>
                <mi>BoxSize</mi>
                <mo>(px)</mo>
                <mo>=</mo>
                <mfrac>
                  <mrow>
                    <mi>ParticleDiameter</mi>
                    <mo>(Å)</mo>
                  </mrow>
                  <mrow>
                    <mi>PixelSize</mi>
                    <mo>(Å/px)</mo>
                  </mrow>
                </mfrac>
                <mo>x</mo>
                <mo>1.3-2</mo>
              </mrow>
            </math>
          </div>
          <p>To increase calculation times the box size should have 2,3,5,7 as its prime factors. For example the following are.</p>
          <pre><code>32,   36,   40,   42,   48,   56,   60,   64,   70,   72,   80,
84,   90,   96,  100,  108,  112,  120,  128,  144,  160,  180,
192,  200,  216,  224,  240,  256,  270,  288,  300,  320,  324,
336,  384,  400,  432,  448,  450,  512, 576,  640,  648,  672,  
720,  768,  784,  810,  864,  882, 1024, 1152, 1280, 1296, 1344, 
1440, 1568, 1620, 1728, 1792, 2000, 2048</code></pre>
          <p>For binning you now divide this by the binning factor (mostly 4).</p>
        </section>

        <section class="section reveal" style="--delay: 0.2s;">
          <h2>When to Unbin Particles</h2>
          <p>In cryo-EM workflows, initial processing is often carried out on binned data. Binning reduces the image resolution by combining adjacent pixels, which greatly speeds up early particle picking, alignment, and classification. This lower resolution is sufficient to discard bad particles and perform initial sorting while keeping computational demands manageable.</p>
          <p>However, as your reconstruction improves, you'll eventually reach a point where the resolution of your binned data nears the Nyquist limit-the maximum detail that your pixel size can theoretically resolve (roughly 2x your pixel size). At this stage, continuing with binned particles means you are losing critical high-resolution details. Re-extracting the particles at the original, unbinned pixel size allows you to capture these finer features and improve the overall resolution of your final map.</p>
          <p>To determine when you've reached the resolution limit, you should monitor the Fourier Shell Correlation (FSC) curve. When the FSC indicates that your reconstruction is approaching half the sampling frequency (i.e., the Nyquist limit), it is a clear signal that the benefits of using the full-resolution data outweigh the computational cost. In practical terms, if your current reconstruction resolution is close to the theoretical maximum given your pixel size, it's time to switch to unbinned particles to push the resolution further.</p>
        </section>

        <section class="section reveal" style="--delay: 0.3s;">
          <h2>When to Restack</h2>
          <p>After several rounds of classification and quality filtering, you may remove a significant portion-often around 50%-of your particles. At this point, it is beneficial to restack your dataset by creating a new particle stack that contains only the high-quality particles. This reduction in data size helps speed up the loading process onto the SSDs of compute nodes.</p>
          <p>While restacking might be less critical for binned data due to its smaller file size, it becomes especially important when working with unbinned data, where larger file sizes can significantly impact data transfer and processing times.</p>
          <p>Additionally, if your dataset contains multiple conformations, it can be advantageous to restack the particles for each conformation separately. Processing them in distinct jobs ensures that only the necessary particles are loaded for each conformation, avoiding the overhead of loading unwanted particles from an older, larger stack.</p>
        </section>
      </main>
    </div>
  </div>
  <script src="scripts/site.js"></script>
</body>
</html>
